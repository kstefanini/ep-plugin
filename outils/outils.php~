<?php

class TelaBotanica_Outils
{


	/* Constructeur de la classe TelaBotanica_Outils */
	public function __construct()
	{				

	}
	
	/* Méthode qui crée la table "{$wpdb->prefix}tb_outils_reglages" dans la base de données lors de l'installation du plugin */
	public function installation()
	{
		global $wpdb;
		$requete1 = "
			CREATE TABLE IF NOT EXISTS '{$wpdb->prefix}tb_outils_reglages' (
			  'id_projet' bigint(11) NOT NULL,
			  'id_outil' varchar(50) NOT NULL,
			  'name' varchar(50) NOT NULL,
			  'prive' tinyint(1) NOT NULL,
			  'create_step_position' tinyint(3) NOT NULL,
			  'nav_item_position' tinyint(3) NOT NULL,
			  'enable_nav_item' tinyint(1) NOT NULL
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
		";
		$requete2 = "
			ALTER TABLE 'wp_tb_outils_reglages'
			ADD PRIMARY KEY ('id_projet','id_outil'),
			ADD KEY 'id_projet' ('id_projet');
		";
		$requete3 = "
			ALTER TABLE 'wp_tb_outils_reglages'
			ADD CONSTRAINT 'fk_id-projet_id-group' FOREIGN KEY ('id_projet') REFERENCES 'wp_bp_groups' ('id') ON DELETE CASCADE ON UPDATE CASCADE;
		";
		$wpdb->query($requete1);
		$wpdb->query($requete2);
		$wpdb->query($requete3);	
		
	}
	
	
	/* Méthode qui supprime la table "{$wpdb->prefix}tb_outils_reglages" dans la base de données lors de la désinstallation du plugin */
	public function desinstallation()
	{
		/* Classe d'accès à la base de données dans WordPress */
		global $wpdb;
	
		/* On vérifie que la table existe puis on la supprime */
		$requete = "DROP TABLE IF EXISTS {$wpdb->prefix}tb_outils_reglages;";		
		$wpdb->query("DROP TABLE IF EXISTS {$wpdb->prefix}tb_outils_reglages;");
	}
	
}
	
